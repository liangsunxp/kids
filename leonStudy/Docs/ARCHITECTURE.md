# 项目架构设计

## 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                        用户浏览器                            │
│                  http://localhost:3000                      │
└──────────────────────────┬──────────────────────────────────┘
                           │ HTTP/REST
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                    前端应用层 (Frontend)                     │
│              React 18 + Ant Design Pro                      │
├─────────────────────────────────────────────────────────────┤
│  Pages        │  Components    │  Services    │  Stores      │
│  ├ Dashboard  │  ├ Layout      │  ├ api.ts    │  ├ auth      │
│  ├ Users      │  ├ Common      │  ├ user.ts   │  └ user      │
│  └ About      │  └ Form        │  └ ...       │              │
├─────────────────────────────────────────────────────────────┤
│              Vite Dev Server (Port 3000)                    │
│              代理: /api → http://localhost:8102             │
└──────────────────────────┬──────────────────────────────────┘
                           │ HTTP REST API
                           │ 请求: /api/users
                           │ 响应: JSON
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                    后端应用层 (Backend)                      │
│                    FastAPI (Python)                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐  │
│  │            API 路由 (main.py)                       │  │
│  │  GET  /api/users        → 获取用户列表             │  │
│  │  POST /api/users        → 创建用户                │  │
│  │  PUT  /api/users/{id}   → 更新用户                │  │
│  │  DELETE /api/users/{id} → 删除用户                │  │
│  └─────────────────────────────────────────────────────┘  │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐  │
│  │          业务逻辑层 (app/services/)                 │  │
│  │  ├─ UserService                                    │  │
│  │  ├─ ItemService                                    │  │
│  │  └─ ...                                            │  │
│  └─────────────────────────────────────────────────────┘  │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐  │
│  │         数据验证层 (app/models/)                    │  │
│  │  ├─ Pydantic Models                               │  │
│  │  └─ 自动验证请求数据                              │  │
│  └─────────────────────────────────────────────────────┘  │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│              Uvicorn 服务器 (Port 8102)                     │
│              CORS 已配置，允许来自 localhost:3000         │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           ▼ (可选)
                  ┌────────────────────┐
                  │   数据库 (Database) │
                  │  (后续添加，暂无)   │
                  └────────────────────┘
```

---

## 通信流程

### 1. 用户加载页面

```
浏览器
  ↓ GET http://localhost:3000
前端应用加载 (React)
  ↓ 初始化组件
Dashboard 组件加载
  ↓ useEffect 触发
调用 API: GET /api/users
  ↓ Vite 代理转发
FastAPI 后端处理
  ↓ 路由匹配
执行 get_users() 函数
  ↓ 返回 JSON
{ "users": [...] }
  ↓ 前端接收
更新状态/Store
  ↓ 重新渲染
页面显示数据
```

### 2. 用户操作（提交表单）

```
用户输入 → 点击提交按钮
  ↓
事件处理器触发
  ↓
收集表单数据
  ↓
调用 API: POST /api/users
  ↓ 请求头: Content-Type: application/json
  ↓ 请求体: { "name": "...", "email": "..." }
Vite 代理转发到 http://localhost:8102
  ↓
FastAPI 接收请求
  ↓
Pydantic 验证数据
  ↓ 如果验证失败 → 返回 422 错误
验证通过 → 执行业务逻辑
  ↓
保存数据（暂时保存在内存）
  ↓
返回结果: { "id": 1, "name": "...", "email": "..." }
  ↓
前端接收响应
  ↓
更新状态
  ↓
显示成功消息
  ↓
刷新列表
```

---

## 层级设计

### 前端 - MVC 模式

```
View (页面组件)
  └─ components/Dashboard.tsx
       │
       ├─ 显示数据
       ├─ 处理用户交互
       └─ 调用 Model/Service
            │
            ▼
Model/Service (业务逻辑)
  └─ services/api.ts
       │
       ├─ 定义 API 调用
       ├─ 数据转换
       └─ 错误处理
            │
            ▼
Controller/Store (状态管理)
  └─ stores/userStore.ts (Zustand)
       │
       ├─ 管理全局状态
       ├─ 状态更新
       └─ 监听状态变化
            │
            ▼
Data (数据源)
  └─ API 服务器 (http://localhost:8102)
```

### 后端 - 分层架构

```
API 层 (Routes)
  └─ main.py, app/routes/
       │
       ├─ 接收 HTTP 请求
       ├─ 路由匹配
       └─ 调用业务逻辑
            │
            ▼
业务逻辑层 (Services)
  └─ app/services/
       │
       ├─ 处理核心业务
       ├─ 数据处理
       └─ 调用数据层
            │
            ▼
数据验证层 (Models)
  └─ app/models/
       │
       ├─ Pydantic 模型
       ├─ 验证请求数据
       └─ 序列化响应数据
            │
            ▼
数据层 (Database)
  └─ 数据库 (暂无)
       │
       ├─ 数据持久化
       ├─ 数据查询
       └─ 事务管理
```

---

## 数据流向

### 请求流程 (Request)

```
1. 前端发起请求
   HTTP POST /api/users
   Body: { "name": "Alice", "email": "alice@example.com" }

2. 网络传输
   请求通过 HTTP 协议传输
   Vite 代理拦截 /api 前缀
   转发到 http://localhost:8102

3. 后端接收
   FastAPI 匹配路由
   /api/users POST → 调用对应函数

4. 数据验证
   Pydantic 验证请求数据
   检查类型、长度、格式等

5. 业务处理
   执行业务逻辑
   保存数据到存储

6. 响应生成
   构建响应对象
   序列化为 JSON

7. 返回前端
   HTTP 200 OK
   Body: { "id": 1, "name": "Alice", ... }

8. 前端处理
   接收响应数据
   更新状态/UI
   显示结果
```

### 响应流程 (Response)

```
后端 → 生成 JSON 响应
  ↓
HTTP 传输层
  ↓
Vite 代理拦截
  ↓
前端 (JavaScript)
  ↓
解析 JSON 数据
  ↓
Axios 拦截器处理 (可选)
  ↓
Promise 解决
  ↓
状态管理 (Store) 更新
  ↓
React 组件重新渲染
  ↓
浏览器显示更新
```

---

## 关键技术点

### 前端关键点

| 技术 | 用途 | 位置 |
|------|------|------|
| React 18 | UI 框架 | src/ |
| TypeScript | 类型安全 | .ts / .tsx 文件 |
| Ant Design Pro | UI 组件库 | components 中使用 |
| Axios | HTTP 客户端 | services/api.ts |
| Zustand (可选) | 状态管理 | stores/ |
| Vite | 开发服务器 | vite.config.ts |

### 后端关键点

| 技术 | 用途 | 位置 |
|------|------|------|
| FastAPI | Web 框架 | main.py |
| Pydantic | 数据验证 | app/models/ |
| Uvicorn | ASGI 服务器 | 启动脚本 |
| Python 异步 | 性能优化 | async/await |
| CORS 中间件 | 跨域配置 | main.py |

---

## 部署架构

### 开发环境

```
开发机
├── 后端进程
│   └─ Python FastAPI
│      ├─ Port: 8102
│      └─ 支持热重载
├── 前端进程
│   └─ Vite Dev Server
│      ├─ Port: 3000
│      ├─ 支持 HMR (热模块替换)
│      └─ 代理配置
└── IDE
    └─ 代码编辑和调试
```

### 生产环境（架构设计）

```
CDN / 静态服务器
├─ 前端构建产物 (dist/)
│  ├─ HTML
│  ├─ JavaScript (已优化)
│  ├─ CSS (已优化)
│  └─ 资源文件
│
Nginx 反向代理
├─ 转发静态请求到前端
└─ 转发 API 请求到后端

后端服务器（云平台）
├─ FastAPI 应用
│  └─ 多个 Uvicorn 工作进程 (使用 Gunicorn)
├─ 数据库
│  └─ PostgreSQL / MySQL
└─ 缓存
   └─ Redis
```

---

## 扩展点

### 未来可以添加的功能

#### 后端

- [ ] **数据库集成** (SQLAlchemy)
- [ ] **认证系统** (JWT / OAuth2)
- [ ] **权限管理** (RBAC)
- [ ] **缓存** (Redis)
- [ ] **日志系统** (logging)
- [ ] **错误监控** (Sentry)
- [ ] **API 版本管理** (v1, v2)
- [ ] **单元测试** (pytest)
- [ ] **文件上传** (多部分表单)
- [ ] **异步任务** (Celery)

#### 前端

- [ ] **用户认证** (登录/注册)
- [ ] **权限控制** (页面访问权限)
- [ ] **国际化** (多语言)
- [ ] **主题切换** (亮色/暗色)
- [ ] **错误边界** (Error Boundary)
- [ ] **性能优化** (代码分割, 懒加载)
- [ ] **单元测试** (Jest, React Testing Library)
- [ ] **E2E 测试** (Cypress)
- [ ] **PWA** (离线支持)
- [ ] **分析** (Google Analytics)

---

## 安全考虑

### 当前阶段

当前项目是学习项目，安全性配置为最小化。

### 生产环境需要考虑

#### 前端安全

- [ ] HTTPS 加密
- [ ] CSP (内容安全策略)
- [ ] XSS 防护
- [ ] CSRF token
- [ ] 敏感信息不存储在 localStorage

#### 后端安全

- [ ] HTTPS 加密
- [ ] 请求验证 (Pydantic)
- [ ] 认证/授权
- [ ] SQL 注入防护 (ORM)
- [ ] 速率限制
- [ ] 输入清理
- [ ] CORS 严格配置
- [ ] 敏感错误信息隐藏

---

## 性能指标

### 目标

| 指标 | 目标值 | 备注 |
|------|--------|------|
| 首屏加载时间 | < 2s | 使用 CDN |
| API 响应时间 | < 200ms | 不含网络延迟 |
| 前端包体积 | < 500KB | 压缩后 |
| 数据库查询 | < 100ms | 带索引 |

### 优化策略

#### 前端

- 代码分割
- 图片优化
- 缓存策略
- 减小包体积

#### 后端

- 数据库索引
- 查询优化
- 缓存层 (Redis)
- 异步处理

---

## 总结

这个前后端分离架构提供：

✅ **清晰的职责划分** - 前后端独立开发和部署
✅ **易于扩展** - 模块化设计便于添加功能
✅ **易于测试** - 各层独立可测试
✅ **高效协作** - 前后端通过 API 契约协作
✅ **生产就绪** - 遵循行业最佳实践

---

